name: Publish Wally Package

on:
  workflow_dispatch:

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - name: Clone Repository
        uses: actions/checkout@v3
      - name: Generate minimal project structure
        run: |
          mkdir temp
          cp -r src temp
          cp wally.toml temp/src
          cp aftman.toml temp/src
          cp README.md temp/src
          cp LICENSE temp/src
          cp default.project.json temp/src
          cd temp/src
      - name: Setup aftman toolchain
        uses: ok-nick/setup-aftman@v0.3.0
      - name: Log in to wally
        env:
          WALLY_AUTH: ${{ secrets.WALLY_AUTH }}
        run: |
          wally login --token $WALLY_AUTH
      - name: Push Release to Wally
        run: wally publish